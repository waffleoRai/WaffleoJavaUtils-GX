/*-----------------------------------------------------
 * Autogenerated Java class from XML definition.
 * Created Fri, 17 Jan 2025 20:34:25 -0600
 *-----------------------------------------------------*/

package waffleoRai_Files.maxis.res.gfx;

import java.io.IOException;
import java.io.Writer;

import org.w3c.dom.Element;

import waffleoRai_Files.XMLReader;
import waffleoRai_Files.maxis.res.XMLInteriorFile;
import waffleoRai_Utils.BufferReference;
import waffleoRai_Utils.FileBuffer;
import waffleoRai_Utils.FileUtils;
import waffleoRai_Utils.StringUtils;

public class ComplatePreset{
	
	private static final String XMLKEY_VERSION = "Version";
	private static final String XMLKEY_CHARCOUNT = "CharCount";
	private static final String XMLKEY_XMLFILE = "XmlFile";
	private static final String XMLKEY__RESERVED = "_reserved";

	public int version;
	public int charCount;
	public XMLInteriorFile xmlFile;
	public int _reserved;
	
	public String xmlImportPath = "./xmlFile.xml";

	private String xmlNodeName;
	private int baseSize;

	public ComplatePreset() {
		xmlNodeName = "ComplatePreset";
		baseSize = 12;
	}
	
	/*----- Read -----*/
	
	protected boolean readBinary_internal(BufferReference dat) {
		if(dat == null) return false;
		
		version = dat.nextInt();
		charCount = dat.nextInt();
		xmlFile = XMLInteriorFile.readBinary(dat, charCount);
		_reserved = dat.nextInt();

		return true;
	}
	
	protected boolean readXMLNode_internal(Element xml_element) {
		if(xml_element == null) return false;
		String nn = xml_element.getNodeName();
		if(nn == null) return false;
		if(!nn.equals(xmlNodeName)) return false;
		
		String aval = null;
		aval = xml_element.getAttribute(XMLKEY_VERSION);
		if(aval != null) version = StringUtils.parseSignedInt(aval);
		//aval = xml_element.getAttribute(XMLKEY_CHARCOUNT);
		//if(aval != null) charCount = StringUtils.parseSignedInt(aval);
		
		Element child = XMLReader.getFirstChildElementWithTagAndAttribute(xml_element, "XMLInteriorFile", "VarName", XMLKEY_XMLFILE);
		if(child != null) {
			xmlImportPath = child.getAttribute("ImportPath");
			//xmlFile = XMLInteriorFile.readXMLNode(child);
		}
		
		aval = xml_element.getAttribute(XMLKEY__RESERVED);
		if(aval != null) _reserved = StringUtils.parseUnsignedInt(aval);

		return true;
	}
	
	public static ComplatePreset readBinary(BufferReference dat) {
		if(dat == null) return null;
		ComplatePreset str = new ComplatePreset();
		if(!str.readBinary_internal(dat)) return null;
		return str;
	}
	
	public static ComplatePreset readXMLNode(Element xml_element) {
		if(xml_element == null) return null;
		ComplatePreset str = new ComplatePreset();
		if(!str.readXMLNode_internal(xml_element)) return null;
		return str;
	}
	
	public boolean loadXML(String wd) throws IOException {
		String abspath = FileUtils.unixRelPath2Local(wd, xmlImportPath);
		xmlFile = XMLInteriorFile.importFile(abspath);
		return xmlFile != null;
	}
	
	/*----- Write -----*/
	
	public int getBinarySize() {
		int size = baseSize;
		if(xmlFile != null) {
			size += xmlFile.getBinarySize();
		}
		return size;
	}
	
	public FileBuffer writeBinary(boolean byteOrder) {
		FileBuffer buff = new FileBuffer(getBinarySize(), byteOrder);
		writeBinaryTo(buff);
		return buff;
	}
	
	public int writeBinaryTo(FileBuffer target) {
		if(target == null) return 0;
		long stPos = target.getFileSize();
		
		if(xmlFile != null) {
			charCount = xmlFile.getCharCount();
		}
		else charCount = 0;
		target.addToFile(version);
		target.addToFile(charCount);
		if(xmlFile != null) xmlFile.writeBinaryTo(target);
		target.addToFile(_reserved);

		return (int)(target.getFileSize() - stPos);
	}

	public void writeXMLNode(Writer out, String indent) throws IOException {
		writeXMLNode(out, indent, null);
	}
	
	public void writeXMLNode(Writer out, String indent, String varName) throws IOException {
		if(out == null) return;
		if(indent == null) indent = "";
		
		out.write(indent);
		out.write(String.format("<%s", xmlNodeName));
		if(varName != null){
			out.write(String.format(" VarName=\"%s\"", varName));
		}
		out.write(String.format(" %s=\"%d\"", XMLKEY_VERSION, version));
		out.write(String.format(" %s=\"%d\"", XMLKEY_CHARCOUNT, charCount));
		out.write(String.format(" %s=\"0x%08x\"", XMLKEY__RESERVED, _reserved));
		out.write(">\n");
		//xmlFile.writeXMLNode(out, indent + "\t", XMLKEY_XMLFILE);
		out.write(indent + "\t<XMLInteriorFile VarName=\"" + XMLKEY_XMLFILE + "\"");
		out.write(String.format(" ImportPath=\"%s\"/>\n", xmlImportPath));
		
		out.write(indent);
		out.write(String.format("</%s>\n", xmlNodeName));
	}

	public boolean saveXML(String wd) throws IOException {
		if(xmlFile == null) return false;
		String abspath = FileUtils.unixRelPath2Local(wd, xmlImportPath);
		return xmlFile.exportFile(abspath);
	}
	
}
