/*-----------------------------------------------------
 * Autogenerated Java class from XML definition.
 * Created Sat, 18 Jan 2025 21:02:33 -0600
 *-----------------------------------------------------*/

package waffleoRai_Files.maxis.res.gfx;

import java.io.IOException;
import java.io.Writer;

import org.w3c.dom.Element;

import waffleoRai_Files.XMLReader;
import waffleoRai_Utils.BufferReference;
import waffleoRai_Utils.FileBuffer;
import waffleoRai_Utils.StringUtils;

public class MaterialInfo{
//TS3 Script: 
	
	public static final String XML_NODE_NAME = "MaterialInfo";
	public static final int BASE_SIZE = 12;

	//private static final String XMLKEY_MAGICNO = "MagicNo";
	private static final String XMLKEY_UNKD = "UnkD";
	//private static final String XMLKEY_DATASIZE = "DataSize";
	private static final String XMLKEY_MATDATA = "MatData";

	public byte[] magicNo = {(byte)'M', (byte)'T', (byte)'N', (byte)'F'};
	public int unkD;
	//public int dataSize;
	public MaterialData matData;

	public MaterialInfo() {}
	
	/*----- Read -----*/
	
	protected boolean readBinary_internal(BufferReference dat) {
		if(dat == null) return false;
		
		magicNo = new byte[4];
		for(int i = 0; i < 4; i++){
			magicNo[i] = dat.nextByte();
		}
		unkD = dat.nextInt();
		dat.add(4L); //dataSize = dat.nextInt();
		matData = MaterialData.readBinary(dat);

		return true;
	}
	
	protected boolean readXMLNode_internal(Element xml_element) {
		if(xml_element == null) return false;
		String nn = xml_element.getNodeName();
		if(nn == null) return false;
		if(!nn.equals(XML_NODE_NAME)) return false;
		
		String aval = null;

		aval = xml_element.getAttribute(XMLKEY_UNKD);
		if(aval != null) unkD = StringUtils.parseUnsignedInt(aval);

		Element child = XMLReader.getFirstChildElementWithTagAndAttribute(xml_element, "MaterialData", "VarName", XMLKEY_MATDATA);
		if(child != null) matData = MaterialData.readXMLNode(child);

		return true;
	}
	
	public static MaterialInfo readBinary(BufferReference dat) {
		if(dat == null) return null;
		MaterialInfo str = new MaterialInfo();
		if(!str.readBinary_internal(dat)) return null;
		return str;
	}
	
	public static MaterialInfo readXMLNode(Element xml_element) {
		if(xml_element == null) return null;
		MaterialInfo str = new MaterialInfo();
		if(!str.readXMLNode_internal(xml_element)) return null;
		return str;
	}
	
	/*----- Write -----*/
	
	public int getBinarySize() {
		int size = BASE_SIZE;
		size += matData.getBinarySize();
		return size;
	}
	
	public FileBuffer writeBinary(boolean byteOrder) {
		FileBuffer buff = new FileBuffer(getBinarySize(), byteOrder);
		writeBinaryTo(buff);
		return buff;
	}
	
	public int writeBinaryTo(FileBuffer target) {
		if(target == null) return 0;
		long stPos = target.getFileSize();
		
		for(int i = 0; i < 4; i++){
			target.addToFile(magicNo[i]);
		}
		target.addToFile(unkD);
		
		int dataSize = matData.getBinarySize();
		target.addToFile(dataSize);
		matData.writeBinaryTo(target, BASE_SIZE);

		return (int)(target.getFileSize() - stPos);
	}

	public void writeXMLNode(Writer out, String indent) throws IOException {
		writeXMLNode(out, indent, null);
	}
	
	public void writeXMLNode(Writer out, String indent, String varName) throws IOException {
		if(out == null) return;
		if(indent == null) indent = "";
		
		out.write(indent);
		out.write(String.format("<%s", XML_NODE_NAME));
		if(varName != null){
			out.write(String.format(" VarName=\"%s\"", varName));
		}
		out.write(String.format(" %s=\"0x%08x\"", XMLKEY_UNKD, unkD));
		out.write(">\n");
		matData.writeXMLNode(out, indent + "\t", XMLKEY_MATDATA);
		out.write(indent);
		out.write(String.format("</%s>\n", XML_NODE_NAME));

	}

}
